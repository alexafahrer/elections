---
title: "️US Presidential Elections"
format: 
  dashboard:
    nav-buttons: [github]
logo: images/logo.png
fig-width: 10
fig-asp: 0.3
---

```{r}
#| label: load-packages
#| message: false
#| include: false
library(tidyverse)
library(DT)
library(usmap)

```

```{r}
#| label: load-data
#| message: false
#| include: false
#| 
presidents <- read_csv("data/1976-2020-president.csv", show_col_types = FALSE)

```

#  {.sidebar}

This dashboard displays weather data for:

**Méribel, [Les Allues](https://en.wikipedia.org/wiki/Les_Allues), Auvergne-Rhône-Alpes, France**

The data were gathered from the [Virtual Crossing](https://www.visualcrossing.com/).

<br>

::: {.callout-note collapse="true"}
## Measurement units

The variables and their measurement units are given below.

|                                      |                      |
|:-------------------------------------|:---------------------|
| **Variable**                         | **Unit** |
| Temperature, Heat Index & Wind Chill | Degrees Fahrenheit   |
| Precipitation                        | Inches               |
| Snow                                 | Inches               |
| Wind & Wind Gust                     | Miles Per Hour       |
| Visibility                           | Miles                |
| Pressure                             | Millibars            |
| Solar Radiation                      | W/m^2^               |
| Solar Energy                         | MJ/m^2^              |

Source: [https://www.visualcrossing.com/resources/documentation/weather-api/unit-groups-and-measurement-units](https://www.visualcrossing.com/resources/documentation/weather-api/unit-groups-and-measurement-units/).
:::


# All

```{r}
#| include: false
# n_snow <- meribel |>
#   filter(snow > 0) |>
#   nrow()
# 
# n_below_freezing <- meribel |>
#   filter(temp < 32) |>
#   nrow()
# 
# n_below_freezing_color <- case_when(
#   n_below_freezing > 5 ~ "danger",
#   n_below_freezing <= 5 &  n_below_freezing > 3 ~ "warning",
#   .default = "light"
#   )

presidents1 <- presidents |>
  filter(party_simplified %in% c("DEMOCRAT", "REPUBLICAN"),
         state != "DISTRICT OF COLUMBIA", 
         year == 2000) |>
  select(party_simplified, year, state_fips, candidatevotes, totalvotes) |>
  mutate(perc_votes = candidatevotes / totalvotes) |>
  arrange(party_simplified) |>
  group_by(year, state_fips) |>
  reframe(rep_dem_diff = diff(perc_votes)) |>
  select(-year) |>
  rename(fips = state_fips, values = rep_dem_diff) 

```


## Row {height="20%"}

```{r}
#| content: valuebox
#| title: "Today"

# list(
#   color = "secondary",
#   value = today
# )

```

```{r}
#| content: valuebox
#| title: "Snowy days"

# list(
#   icon = "snow",
#   color = "primary",
#   value = n_snow
# )

```

```{r}
#| content: valuebox
#| title: "Number of days below freezing"

# list(
#   icon = "thermometer-snow",
#   color = n_below_freezing_color,
#   value = n_below_freezing
# )

```

## Row {height="40%"}

### Column {width="40%"}

```{r}
#| title: Snow fall (in)

# ggplot(meribel, aes(x = datetime, y = snow)) +
#   geom_line() +
#   geom_vline(
#     xintercept = today, linetype = "dashed", 
#     color = "#ae8b2d", linewidth = 1.5
#   ) +
#   labs(
#     x = "Date",
#     y = "Snow fall"
#   )

plot_usmap("states", data = presidents1) +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", midpoint = 0)

```

### Column {width="40%"}

```{r}
#| title: Snow depth (in)

# ggplot(meribel, aes(x = datetime, y = snowdepth)) +
#   geom_line() +
#   geom_vline(
#     xintercept = today, linetype = "dashed", 
#     color = "#ae8b2d", linewidth = 1.5
#   ) +
#   labs(
#     x = "Date",
#     y = "Snow depth"
#   )

```
