---
title: "️US Presidential Elections"
format: 
  dashboard:
    nav-buttons: [github]
---

```{r}
#| label: load-packages-and-data
#| message: false
#| include: false

library(tidyverse)
library(DT)
library(usmap)
library(shiny)
library(tools)

presidents <- read_csv("data/1976-2020-president.csv", show_col_types = FALSE)
```

#  {.sidebar}

This dashboard displays the various presidential election data from 1976 to 2020. 
<hr>

Begin by selecting a year to investigate:
```{r}
#| label: user-input

selectInput(
  inputId = "input_year",
  label = strong("Election Year"),
  choices = unique(presidents$year),
  selected = 1976
)

# https://quarto.org/docs/interactive/
```

<hr>

::: {.callout-note}
## Note

These plots represents the **popular vote** within each state. This does not reflect the electoral college votes. 
:::

# Home

Welcome!

<br>

::: {.card title="About the Data"}
MIT Election Data and Science Lab, [MIT Data Lab](https://electionlab.mit.edu/)

The data were gathered from the [Harvard Dataverse Database](https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/42MVDX).
:::

# Dashboard

```{r}
#| label: functions
#| include: false

reformat_name <- function(name) {
  parts <- strsplit(name, ", ")[[1]]
  formatted_name <- paste(trimws(parts[2]), trimws(parts[1]))
  text_lower <- tolower(formatted_name)
  formatted_name <- toTitleCase(text_lower)
  return(formatted_name)
}

lower_case <- function(name) {
  text_lower <- tolower(name)
  formatted_name <- toTitleCase(text_lower)
  return(formatted_name)
}

multiply_by_100 <- function(x) {
  return(paste0(x * 100, " points"))
}
```

```{r}
#| label: data-sets-for-plots
#| include: false

presidents_winner <- presidents |>
  filter(
    year == 1976,
    party_simplified %in% c("DEMOCRAT", "REPUBLICAN")
  ) |>
  group_by(state) |>
  filter(candidatevotes == max(candidatevotes)) |>
  ungroup() |>
  select(year, state, state_fips, candidate, party_simplified, candidatevotes, totalvotes) |>
  group_by(candidate) |>
  summarize(total_votes = sum(candidatevotes)) |>
  mutate(perc = total_votes / sum(total_votes)) |>
  group_by(candidate) |>
  mutate(candidate = reformat_name(candidate)) |>
  ungroup()

gradient_map_data <- presidents |>
  filter(
    party_simplified %in% c("DEMOCRAT", "REPUBLICAN"),
    state != "DISTRICT OF COLUMBIA",
    year == 1976
  ) |>
  select(party_simplified, year, state_fips, candidatevotes, totalvotes) |>
  mutate(perc_votes = candidatevotes / totalvotes) |>
  arrange(party_simplified) |>
  group_by(year, state_fips) |>
  reframe(rep_dem_diff = diff(perc_votes)) |>
  select(-year) |>
  rename(fips = state_fips, values = rep_dem_diff)

red_blue_map_data <- presidents |>
  filter(year == 1976) |>
  group_by(state) |>
  filter(candidatevotes == max(candidatevotes)) |>
  ungroup() |>
  select(state_fips, party_detailed) |>
  rename(fips = state_fips, values = party_detailed)

swing_states <- presidents |>
  filter(
    party_simplified %in% c("DEMOCRAT", "REPUBLICAN"),
    year == 1976
  ) |>
  mutate(swing_state = if_else(state_po %in% c("NM", "NV", "IA", "FL", "VA", "OK", "TN"), TRUE, FALSE)) |>
  select(state_fips, swing_state) |>
  rename(fips = state_fips, values = swing_state)

#1976:
#1980: 
#1984: 
#1988: c("NV", "AZ", "WI", "MI", "PA", "NC", "GA")
#1992: c("NV", "AZ", "MT", "OH", "NH", "NJ", "NC", "GA", "FL")
#1996: c("NV", "AZ", "MT", "CO", "KY", "VA", "TN", "GA")
#2000: c("OR", "NM", "MN", "IA", "WI", "NH", "FL")
#2004: c("NV", "NM", "IA", "WI", "OH", "PA", "NH")
#2008: c("MT", "MO", "IN", "NC", "FL")
#2012: c("OH", "NC", "FL")
#2016: c("NV", "MN", "WI", "MI", "PA", "NH", "ME", "FL")
#2020: c("NV", "AZ", "WI", "MI", "PA", "NC", "GA")
# https://usafacts.org/articles/what-are-the-current-swing-states-and-how-have-they-changed-over-time/ 
```

## Row {height="15%"}

```{r}
#| content: valuebox
#| title: "Year"

list(
  color = "secondary",
  value = "1976"
)
```

```{r}
#| content: valuebox
#| title: "Popular Vote Winner"

list(
  color = "#346EF0",
  value = presidents_winner |>
    filter(perc == max(perc)) |>
    pull(candidate)
)
```

```{r}
#| content: valuebox
#| title: "Percentage of Popular Vote Won"

list(
  color = "secondary",
  value = presidents_winner |>
    filter(perc == max(perc)) |>
    mutate(perc = scales::percent(perc, accuracy = 0.1)) |>
    pull(perc)
)
```

```{r}
#| content: valuebox
#| title: "Losing Candidate"

list(
  color = "#EB3323",
  value = presidents_winner |>
    filter(perc == min(perc)) |>
    pull(candidate)
)
```

## Row {height="40%"}

### Column {width="40%", .fill}

```{r}
#| title: Presidential Gradient
#| padding: 0px

plot_usmap("states", data = gradient_map_data) +
  scale_fill_gradient2(
    labels = multiply_by_100, low = "#346EF0",
    high = "#EB3323", mid = "white", midpoint = 0
  ) +
  labs(fill = "Point Differential") +
  theme(
    legend.position = "right",
    legend.title = element_text(vjust = 1, face = "bold", size = 14),
    legend.key.size = unit(1.2, "cm"),
    legend.text = element_text(size = 12)
  )
```

### Column {width="40%", .fill}

```{r}
#| title: Presidential Winners
#| padding: 0px

plot_usmap("states", data = red_blue_map_data) +
  scale_fill_manual(values = c("#346EF0", "#EB3323"), labels = lower_case) +
  labs(fill = "Presidential Party") +
  theme(
    legend.position = "right",
    legend.title = element_text(vjust = 1, face = "bold", size = 14),
    legend.key.size = unit(1.2, "cm"),
    legend.text = element_text(size = 12)
  )
```

## Row {height="15%"}

### Column {width="20%" expandable: false}

```{r}
#| title: "Swing State #1: Iowa"

plot_usmap("states", include = "IA", data = red_blue_map_data, show.legend = FALSE) +
  scale_fill_manual(values = c("DEMOCRAT" = "#346EF0", "REPUBLICAN" = "#EB3323"))
```

### Column {width="20%" expandable: false}

```{r}
#| title: "Swing State #2: North Carolina"

plot_usmap("states", include = "NC", data = red_blue_map_data, show.legend = FALSE) +
  scale_fill_manual(values = c("DEMOCRAT" = "#346EF0", "REPUBLICAN" = "#EB3323"))
```

### Column {width="20%" expandable: false}

```{r}
#| title: "Swing State #3: Arizona"

plot_usmap("states", include = "AZ", data = red_blue_map_data, show.legend = FALSE) +
  scale_fill_manual(values = c("DEMOCRAT" = "#346EF0", "REPUBLICAN" = "#EB3323"))
```

### Column {width="20%" expandable: false}

```{r}
#| title: "Swing State #4: Ohio"

plot_usmap("states", include = "OH", data = red_blue_map_data, show.legend = FALSE) +
  scale_fill_manual(values = c("#346EF0", "#EB3323"))
```

### Column {width="20%" expandable: false}

```{r}
#| title: "Swing State #5: Florida"

plot_usmap("states", include = "FL", data = red_blue_map_data, show.legend = FALSE) +
  scale_fill_manual(values = c("#346EF0", "#EB3323"))
```

# Swing States

## Row {height="20%"}

### Column {width="20%"}

```{r}
#| content: valuebox
#| title: "Year"

list(
  color = "secondary",
  value = "1976"
)
```

### Column {width="80%"}

```{r}
#| content: valuebox
#| title: "Question"

# NEED TO DO: make text smaller

list(
  color = "secondary",
  value = "What states are swing states in each election year?"
)
```

## Row {height="80%"}

```{r}
#| title: "Swing States"

plot_usmap("states", data = swing_states) +
  scale_fill_manual(values = c("gray", "purple")) +
  labs(fill = "Swing State") +
  theme(
    legend.position = "right",
    legend.title = element_text(face = "bold")
  )
```

# Data

```{r}
#| label: data-table

presidents_datatable <- presidents |>
  select(year, state, candidate, party_detailed, writein, candidatevotes, totalvotes) |>
  rowwise() |>
  mutate(
    percentage_of_votes = scales::percent(candidatevotes / totalvotes, accuracy = 0.01),
    state = lower_case(state),
    # candidate = reformat_name(candidate),
    party_detailed = lower_case(party_detailed),
    writein = lower_case(writein)
  ) |>
  rename(
    "Year" = "year", "State" = "state", "Candidate Name" = "candidate",
    "Political Party" = "party_detailed", "Write In?" = "writein",
    "Candidate Votes" = "candidatevotes", "Total State Votes" = "totalvotes",
    "Percentage of Total Vote in State" = "percentage_of_votes"
  )

datatable(presidents_datatable)
```

# Write Up {scrolling="true"}

::: {.card title="Introduction" .flow} 
Our project was conducted by Team Ella, composed of Alexa Fahrer, Ryan Silver, Noah Costa, and Ella Hartman. While statistics is nearly the only academic similarity among the team, our team is interested in examining presidential voting trends in the wake of the upcoming presidential election this November. We are from Arizona, Missouri, New York, and Alabama, respectively, states with varied voting trends and histories. We were enthusiastic to see what insights we could uncover in a dataset involving the state-based history of presidential elections. 
:::

::: {.card title="Project Goals & Overview" .flow} 
Our original goals were twofold. For one, we were very interested in seeing how presidential voting behaviors in states within the US have changed over time. To investigate this question, we seek to create two maps: first, a gradient map showing the depth of polarization for individual states, and second, a map that only highlights the popular vote winner by state. Secondly, we were curious to see how swing states have emerged and changed since 1976. For this, we seek to create a map highlighting the swing states in every presidential election year. 

To answer these questions, we chose to make a quarto dashboard. The user can select a presidential election year (from 1976 to 2020) to investigate in the dashboard. On the first tab, after a year is selected, the dashboard shows the popular vote winner and percentage, popular vote loser, the USA gradient map, the USA popular vote winner map, and five well-known swing states colored either red or blue. On the second dashboard tab, we show a map of the US with the swing states highlighted purple, classified by if the popular vote candidate is within 3 percentage points of the next highest candidate. The last tab of the dashboard displays a data table of the raw data used in the dashboard.
:::

::: {.card title="Data" .flow} 
Our data originally came from the MIT Election Data and Science Lab, and we accessed the data through the Harvard Dataverse Database. It consists of 4,287 observations and 15 variables, including year, state, state_po, state_fips, state_cen, state_ic, office, candidate, party_detailed, writein, candidatevotes, totalvotes, version, notes, and party_simplified. 

While creating the plots, we filtered the data set for candidates only running in the Democrat or Republican party. We did this because no third-party candidate has ever won the popular vote in a presidential election. Our two maps have states colored red and blue to indicate whether the Republican or Democrat candidate won the popular vote in that state (based on standardized political party colors). The gradient map was determined by the percentage of voters who voted for the Republican candidate minus the percentage of voters who voted for the Democrat candidate. This number was multiplied by 100 to get the number of “points” by which a state skewed Democrat or Republican. The second map shows the outright winner of the popular vote in each state, which was determined by whether the percentage of voters who voted for the Democrat candidate or Republican candidate was bigger. 

On the data tab of our quarto dashboard, we show the data set with all 4,287 observations and the following variables: Year, State, Candidate Name, Political Party, Write-In?, Candidate Votes, Total State Votes, and Percentage of Total Vote in State. We left out other variables that were not relevant and would not be useful for the user in viewing the raw data. The “Percentage of Total Vote in State” for every candidate was calculated by taking the number of votes for each candidate and dividing it by the total votes for each state.
:::

::: {.card title="Why a Quarto Dashboard" .flow} 
We decided a quarto dashboard would be the best method to display our findings because we could show the answers to these questions all at once in a fashion that clearly shows why we group certain answers together. Our first tab is an overview: we want to show the gradient and the popular vote maps together as well as a few swing states that are well-known with a link to our swing state dashboard. The second tab on the dashboard shows the swing states. It doesn’t quite answer how popular vote by state has changed over history, which is responded to on our first tab, but instead answers our second question about how swing states have changed. On this tab, we have the states that swing in a given year highlighted. Our last tab allows the viewer to scroll and see all of the different observations of our data. We chose to use a Quarto dashboard instead of a Shiny app or a Quarto document because the Quarto dashboard has a clean interface and is a better user experience than the clunkiness of a Shiny app. We appreciated the opportunity to use multiple tabs to investigate separate aspects of the data. 
:::

::: {.card title="Takeaways & Findings" .flow} 
[fill in later]
:::

::: {.card title="Limitations" .flow} 
Our work does have a few limitations and challenges. One is that those unfamiliar with United States geography may not understand which states are which on our graph. However, we felt that labeling the states was the only solution to this problem, and doing so would highly clutter our map. Thus, our map is directed towards those who know American geography. We additionally had to exclude the District of Columbia in our gradient map because it was so Democrat-leaning that it made every other Democratic state look almost white on the map (our gradient relies on comparing the most extreme states to more moderate states for coloring; even heavy-leaning democratic states looked only moderately blue). However, because DC is so geographically small, it would have been hard to see in the first place, and excluding it does not change the look of our graph. Going forward, we plan to use this dashboard as an informational tool to better educate people on trends throughout the years, especially in preparation for this upcoming election. It is important that people understand where current voting trends stand in the context of a historical lens. 
:::

::: {.card title="Conclusion" .flow}
We originally wanted to see how voting patterns by state have changed, and we wanted to see how swing states have changed in presidential elections from 1976 to 2020. As a result of our work and methodologies, we can see these patterns on a by-state basis. 
[finish]
:::

# About

::: {.card}
This project was developed by **Team Ella** in Spring 2024 for [STA/ISS 313: Advanced Data Visualization](https://vizdata.org/) at Duke University. The team is comprised of the following team members.

-   Team member 1: My name is [Ryan Silver](https://github.com/ryan-silver), a sophomore from St. Louis, and I am majoring in Economics and minoring in Statistical Science. I love playing pickleball and racquetball in my free time.
-   Team member 2: My name is [Alexa Fahrer](https://github.com/alexafahrer), a sophomore from Phoenix, and I am a double major in Public Policy and Statistics with a minor in Education. In my free time, I enjoy watching movies, cheering on the 49ers, and playing pickleball.
-   Team member 3: My name is [Ella Hartman](https://github.com/ellahartman) and I am a senior from Birmingham, Alabama studying Computer Science and Economics.
-   Team member 4: My name is [Noah Costa](https://github.com/Noah-Costa14) and I am a senior from Long Island, New York studying Computer Science.
:::