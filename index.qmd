---
title: "️US Presidential Elections"
format: 
  dashboard:
    nav-buttons: [github]
server: shiny
---

```{r}
#| label: load-packages-and-data
#| message: false
#| include: false
#| context: setup

library(tidyverse)
library(DT)
library(usmap)
library(shiny)

presidents <- read_csv("data/1976-2020-president.csv", show_col_types = FALSE)
```

## {.sidebar}

This dashboard displays presidential election data from 1976 to 2020. 
<hr>

Begin by selecting a year to investigate:
```{r}
#| label: user-input

selectInput(
  inputId = "input_year",
  label = strong("Election Year"),
  choices = unique(presidents$year),
  selected = "1976"
)

# https://quarto.org/docs/interactive/
```

<hr>

::: {.callout-note}
## Note

This data represents the **popular vote** in each state, not the electoral college vote. 
:::

# Home

Welcome to our dashboard!

This project examines presidential voting trends in the United States. With a shared interest in statistics and a curiosity about the upcoming presidential election, we aimed to analyze historical data to uncover insights into state-based voting behaviors. The goal of our project was to create an interactive tool for users to explore trends in voting behaviors in the wake of the upcoming presidential election in November 2024. With our dashboard, we hope to help users investigate two main objectives. The first goal is to give users insight into the changes of presidential voting behaviors over time, particularly focusing on state-level trends. To achieve this, we created two maps: one using a gradient to display the candidate polarization within a state and another simply coloring the popular vote winner by state. Secondly, we wanted to examine the emergence and evolution of swing states since 1976. We developed a Quarto dashboard to allow users to select presidential election years from 1976 to 2020 for analysis. The dashboard provides a comprehensive view of each selected year, showing the popular vote winner and loser, gradient maps indicating point differential, states of interest, and swing states. 

---

Page Descriptions

- [Home:](#home) Home page with project abstract, navigation, and information about the data.
- [Elections:](#elections) Interactive dashboard to select a presidential election year from 1976 to 2020 and explore trends through visualizations.
- [Swing States:](#swing-states) Interactive dashboard to investigate swing states and their voting trends in presidential elections from 1976 to 2020.
- [Data:](#data) A table displaying the raw data used in the project.
- [Write Up:](#write-up) Page with the required write-up for the class.
- [About:](#about) Page describing the team members involved in the project.

---

About the Data

The data were originally collected by the [MIT Election Data and Science Lab](https://electionlab.mit.edu/). We accessed the data through the [Harvard Dataverse Database](https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/42MVDX).


```{r}
#| label: functions
#| include: false

lower_case <- function(name) {
  text_lower <- tolower(name)
  formatted_name <- tools::toTitleCase(text_lower)
  return(formatted_name)
}
```

```{r}
#| label: data-sets-for-plots
#| include: false
#| context: server

presidents_winner <- reactive({
  presidents |>
    filter(
      year == input$input_year,
      party_simplified %in% c("DEMOCRAT", "REPUBLICAN")
    ) |>
    group_by(state) |>
    filter(candidatevotes == max(candidatevotes)) |>
    ungroup() |>
    select(year, state, state_fips, candidate, party_simplified, candidatevotes, totalvotes) |>
    group_by(candidate) |>
    summarize(total_votes = sum(candidatevotes)) |>
    mutate(perc = total_votes / sum(total_votes)) |>
    group_by(candidate) |>
    ungroup()
})

gradient_map_data <- reactive({
  presidents |>
    filter(
      party_simplified %in% c("DEMOCRAT", "REPUBLICAN"),
      state != "DISTRICT OF COLUMBIA",
      year == input$input_year
    ) |>
    select(party_simplified, year, state_fips, candidatevotes, totalvotes) |>
    mutate(perc_votes = candidatevotes / totalvotes) |>
    arrange(party_simplified) |>
    group_by(year, state_fips) |>
    reframe(rep_dem_diff = diff(perc_votes)) |>
    select(-year) |>
    rename(fips = state_fips, values = rep_dem_diff)
})

red_blue_map_data <- reactive({
  presidents |>
    filter(year == input$input_year) |>
    group_by(state) |>
    filter(candidatevotes == max(candidatevotes)) |>
    ungroup() |>
    select(state_fips, party_simplified) |>
    rename(fips = state_fips, values = party_simplified)
})

swing_states <- reactive({
  gradient_map_data() |>
    filter(
      abs(values) < 0.03
      ) |>
    mutate(values = TRUE)
})

swing_state_values <- reactive({
  swing_states() |>
    pull(fips)
})

swing_states_red_blue <- reactive({
  presidents |>
    filter(
      party_simplified %in% c("DEMOCRAT", "REPUBLICAN"),
      year == input$input_year, 
      state_fips %in% swing_state_values()
    ) |>
    select(state_fips, party_simplified) |>
    rename(fips = state_fips, values = party_simplified)
})
```

# Elections {scrolling="false"}

## Row {height="10%"}

### Column {width="25%"}

```{r}
#| content: valuebox
#| title: "Year"

textOutput("input_year")
```

```{r}
#| context: server

output$input_year <- renderText({
  input$input_year
})
```

### Column {width="25%"}

```{r}
#| content: valuebox
#| title: "Popular Vote Winner"
#| color: "green"

textOutput("winner_name")
```

```{r}
#| context: server

output$winner_name <- renderText({
  candidate_name <- presidents_winner() |>
    filter(perc == max(perc)) |>
    pull(candidate)
  candidate_name
  
  # # Split the name into parts
  # parts <- str_split(candidate_name, ", ")[[1]]
  # 
  # # Identify and handle the suffix "Jr"
  # suffix <- ifelse(grepl("Jr$", parts[2]), "Jr", "")
  # first_part <- str_replace(parts[2], "Jr$", "")
  # 
  # # Trim, rearrange, and reformat the name
  # formatted_name <- paste(trimws(first_part), trimws(parts[1]))
  # text_lower <- tolower(formatted_name)
  # formatted_name <- toTitleCase(text_lower)
  # 
  # # Append the suffix if it exists
  # if (nchar(suffix) > 0) {
  #   formatted_name <- paste(formatted_name, suffix)
  # }
  # 
  # formatted_name
})
```

### Column {width="25%"}

```{r}
#| content: valuebox
#| title: "Losing Candidate"

textOutput("loser_name")
```

```{r}
#| context: server

output$loser_name <- renderText({
  presidents_winner() |>
    filter(perc == min(perc)) |>
    pull(candidate)
})
```

### Column {width="25%"}

```{r}
#| content: valuebox
#| title: "Winner Vote Percentage"

textOutput("winning_percentage")
```

```{r}
#| context: server

output$winning_percentage <- renderText({
  presidents_winner() |>
    filter(perc == max(perc)) |>
    mutate(perc = scales::percent(perc, accuracy = 0.1)) |>
    pull(perc)
})
```

## Row {height="20%"}

### Column {width="50%", .fill}

```{r}
#| context: server

output$gradient_map <- renderPlot({
  plot_usmap("states", data = gradient_map_data()) +
  scale_fill_gradient2(
    labels = scales::label_number(scale = 100, suffix = " points"),
    low = "#346EF0",
    high = "#EB3323", mid = "white", midpoint = 0
  ) +
  labs(fill = "Point Differential") +
  theme(
    legend.position = "right",
    legend.title = element_text(vjust = 1, size = 14),
    legend.key.size = unit(1.2, "cm"),
    legend.text = element_text(size = 12)
  )
})
```

```{r}
#| title: Presidential Gradient^[The "point differential" is the difference of the vote share each candidate received from the total number of votes cast in the state, including votes cast for third-party candidates.]
#| padding: 0px

plotOutput("gradient_map")
```

### Column {width="50%", .fill}

```{r}
#| context: server

output$red_blue_map <- renderPlot({
  plot_usmap("states", data = red_blue_map_data()) +
  scale_fill_manual(
    values = c("DEMOCRAT" = "#346EF0", "REPUBLICAN" = "#EB3323"),
    labels = c("Democrat", "Republican"), 
    breaks = c("DEMOCRAT", "REPUBLICAN")
  ) +
  labs(fill = "Presidential Party") +
  theme(
    legend.position = "right",
    legend.title = element_text(vjust = 1, size = 14),
    legend.key.size = unit(1.2, "cm"),
    legend.text = element_text(size = 12)
  )
})
```

```{r}
#| title: Presidential Winners
#| padding: 0px

plotOutput("red_blue_map")
```

## Row {height="10%"}

### Column {width="20%"}

```{r}
#| context: server

output$user_map <- renderPlot({
  plot_usmap("states", include = input$selected_state, data = red_blue_map_data(), show.legend = FALSE) +
  scale_fill_manual(values = c("DEMOCRAT" = "#346EF0", "REPUBLICAN" = "#EB3323"))
})
```

```{r}
#| content: card-toolbar
selectInput(
  inputId = "selected_state",
  label = NULL,
  choices = unique(presidents$state_po),
  selected = "NC"
)
```


```{r}
#| title: "Select a State:"

plotOutput("user_map")
```

### Column {width="20%"}

```{r}
#| context: server

output$al_map <- renderPlot({
  plot_usmap("states", include = "AL", data = red_blue_map_data(), show.legend = FALSE) +
  scale_fill_manual(values = c("DEMOCRAT" = "#346EF0", "REPUBLICAN" = "#EB3323"))
})
```

```{r}
#| title: "State of Interest #2: Alabama"

plotOutput("al_map")
```

### Column {width="20%"}

```{r}
#| context: server

output$az_map <- renderPlot({
  plot_usmap("states", include = "AZ", data = red_blue_map_data(), show.legend = FALSE) +
  scale_fill_manual(values = c("DEMOCRAT" = "#346EF0", "REPUBLICAN" = "#EB3323"))
})
```

```{r}
#| title: "State of Interest #3: Arizona"

plotOutput("az_map")
```

### Column {width="20%"}

```{r}
#| context: server

output$mo_map <- renderPlot({
  plot_usmap("states", include = "MO", data = red_blue_map_data(), show.legend = FALSE) +
  scale_fill_manual(values = c("DEMOCRAT" = "#346EF0", "REPUBLICAN" = "#EB3323"))
})
```

```{r}
#| title: "State of Interest #4: Missouri"

plotOutput("mo_map")
```

### Column {width="20%"}

```{r}
#| context: server

output$ny_map <- renderPlot({
  plot_usmap("states", include = "NY", data = red_blue_map_data(), show.legend = FALSE) +
  scale_fill_manual(values = c("DEMOCRAT" = "#346EF0", "REPUBLICAN" = "#EB3323"))
})
```

```{r}
#| title: "State of Interest #5: New York"

plotOutput("ny_map")
```

# Swing States

## Row {height="30%"}

### Column {width="50%"}
 
```{r}
#| content: valuebox
#| title: "Year"

textOutput("swing_input_year")
```

```{r}
#| context: server

output$swing_input_year <- renderText({
  input$input_year
})
```

### Column {width="50%"}

```{r}
#| content: valuebox
#| title: "Number of Swing States"

textOutput("selected_year")
```

```{r}
#| context: server

output$selected_year <- renderText({
  nrow(swing_states())
})
```

## Row {height="70%"}

### Column {width="50%"}

```{r}
#| context: server

output$swing_states_map <- renderPlot({
  plot_usmap("states", data = swing_states()) +
    scale_fill_manual(values = "#BA68C8", na.value = "#D3D3D3") +
    labs(fill = "Swing State") +
    theme(
      legend.position = "none"
    )
})
```

```{r}
#| title: Swing States (In Purple)^[The swing states are calculated to be states [won by a margin of three points or less](https://usafacts.org/articles/what-are-the-current-swing-states-and-how-have-they-changed-over-time/)]

plotOutput("swing_states_map")
```

### Column {width="50%"}

```{r}
#| context: server

output$swing_states_red_blue_map <- renderPlot({
  plot_usmap("states", data = swing_states_red_blue()) +
    scale_fill_manual(values = c("#EB3323", "#346EF0"), 
                      na.value = "#D3D3D3") +
    labs(fill = "Swing State") +
    theme(
      legend.position = "none"
    )
})
```

```{r}
#| title: Swing State Voting Behaviors

plotOutput("swing_states_red_blue_map")
```

# Data

```{r}
#| label: data-table

presidents_datatable <- presidents |>
  select(year, state, candidate, party_detailed, writein, candidatevotes, totalvotes) |>
  rowwise() |>
  mutate(
    percentage_of_votes = scales::percent(candidatevotes / totalvotes, accuracy = 0.01),
    state = lower_case(state),
    party_detailed = lower_case(party_detailed),
    writein = lower_case(writein)
  ) |>
  rename(
    "Year" = "year", "State" = "state", "Candidate Name" = "candidate",
    "Political Party" = "party_detailed", "Write In?" = "writein",
    "Candidate Votes" = "candidatevotes", "Total State Votes" = "totalvotes",
    "Percentage of Total Vote in State" = "percentage_of_votes"
  )

datatable(presidents_datatable)
```

# Write Up {scrolling="true"}

::: {.card title="Introduction" .flow} 
Our project was conducted by Team Ella, composed of Alexa Fahrer, Ryan Silver, Noah Costa, and Ella Hartman. While statistics is nearly the only academic similarity among the team, our team is interested in examining presidential voting trends in the wake of the upcoming presidential election this November. We are from Arizona, Missouri, New York, and Alabama, respectively, states with varied voting trends and histories. We were enthusiastic to see what insights we could uncover in a data set involving the state-based history of presidential elections. 
:::

::: {.card title="Project Goals & Overview" .flow} 
The goal of our project is to create an informational tool for users to explore state-level voting histories in US presidential elections. With our tool, we hope to allow users to investigate two specific topics. The first goal is to give users insight into the changes in presidential voting behaviors over time, particularly focusing on state-level trends. To achieve this, we created two maps: one using a gradient to display the candidate polarization within a state and another simply coloring the popular vote winner by state. Secondly, we were curious to see how swing states have emerged and changed since 1976. For this, we seek to create two additional maps: one that simply highlights the swing states in every presidential election year and a second map that indicates which way the state swung.

To explore these questions, we chose to make an interactive quarto dashboard. The user can select a presidential election year (from 1976 to 2020) to investigate in the dashboard. The year of interest can be selected on the left-hand side of the page. After a year is selected, both tabs that display maps will update to the proper year. On the first tab, [Elections](#elections), the dashboard shows the popular vote winner and percentage, popular vote loser, the US gradient map, the US popular vote winner map, and five states of interest colored either red or blue. The user can select one state to investigate and the other four are our home states. On the second dashboard tab, [Swing States](#swing-states), we show a map of the US with the swing states highlighted in purple. For our project, a swing state is as any by if the popular vote candidate is within 3 percentage points of the next highest candidate. The other tabs of our dashboard include the pages [Home](#home), [Data](#data), [Write Up](#write-up), and [About](#about). On the [Home](#home) page, the user can find an introduction to our project; on the [Data](#data) page, the user can find access to the raw data we used; on the [Write Up](#write-up) page, the user can find the entirety of our process; and on the [About](#about) page, the user can read about the creators of the project and the purpose for creation. 
:::

::: {.card title="Data" .flow} 
Our data originally came from the MIT Election Data and Science Lab, and we accessed the data through the Harvard Dataverse Database. It consists of `{r} nrow(presidents)` observations and `{r} ncol(presidents)` variables, including `year`, `state`, `state_po`, `state_fips`, `state_cen`, `state_ic`, `office`, `candidate`, `party_detailed`, `writein`, `candidatevotes`, `totalvotes`, `version`, `notes`, and `party_simplified.` 

While creating the plots, we filtered the data set for candidates only running in the Democrat or Republican party. We did this because no third-party candidate has ever won the popular vote in a presidential election. Our two maps have states colored red and blue to indicate whether the Republican or Democrat candidate won the popular vote in that state (based on standardized political party colors). The gradient map was determined by the percentage of voters who voted for the Republican candidate minus the percentage of voters who voted for the Democrat candidate. This number was multiplied by 100 to get the number of “points” by which a state skewed Democrat or Republican. The second map shows the outright winner of the popular vote in each state, which was determined by whether the percentage of voters who voted for the Democrat candidate or Republican candidate was bigger. For our project, a swing state is as any by if the popular vote candidate is within 3 percentage points of the next highest candidate.

On the data tab of our quarto dashboard, we show the data set with all `{r} nrow(presidents)` observations and the following variables: `Year`, `State`, `Candidate Name`, `Political Party`, `Write-In?`, `Candidate Votes`, `Total State Votes`, and `Percentage of Total Vote in State.` We left out other variables that were not relevant and would not be useful for the user in viewing the raw data. `Percentage of Total Vote in State` for every candidate was calculated by taking the number of votes for each candidate and dividing it by the total votes for each state.
:::

::: {.card title="Why a Quarto Dashboard" .flow} 
We decided a quarto dashboard would be the best method to display our findings because we could show the answers to these questions all at once in a fashion that clearly shows why we group certain answers together. Our first tab is an overview: we want to show the gradient and the popular vote maps together as well as allow the users to investigate a state of their choice. The second tab on the dashboard shows the swing states. These maps answer our second question about how swing states have changed. On this tab, we have the states that swing in a given year highlighted. Our last tab allows the viewer to scroll and see all of the different observations of our data. We chose to use a Quarto dashboard instead of a Shiny app or a Quarto document because the Quarto dashboard has a clean interface and is a better user experience than the clunkiness of a Shiny app. The integration of a Shiny server in the Quarto dashboard introduces an interactive element where the user can select a year and state. We appreciated the opportunity to use multiple tabs to investigate separate aspects of the data.
:::

::: {.card title="Findings" .flow} 
Our Quarto dashboard proves an effective informational tool for users to educate themselves about historical voting trends before the upcoming election. We can also see insights into changes in popular voting since 1976, as well as the emergence of different swing states. 

Starting in 1976 and making their way through 2020, voting trends have been relatively volatile. Democrats dominated the Southeast, Northern Midwest, and New York area while Republicans dominated mainly the Western US in 1976. The 1980s were dominated by a massive Republican push virtually all around the country. 1992 and 1996 marked a swing back to the Democratic party, fueled mostly by Republican to Democratic switches in the West, Northeast, and Mississippi River states. The year 2000 swung back towards the Republicans, just barely, as many of these Southern Mississippi River states switched. 2004 shows a switch to more Republican and 2008 and 2012 suddenly flip back to Democrat, as the Northeast, Upper Midwest, and West become Democratic and the South and Western Midwest stay Republican. In 2016, for the first time since the 1980s, the Upper Midwest became Republican-leaning, though in 2020, some of these states and Arizona turned blue. As of 2020, Democrats mainly take the Western and Southwestern US, Northeast, and Upper Midwest, while the Republicans take mainly Southern and Western Middle America as well as the South.

We defined swing states as states won by a margin of three points or less. In 1976, the US would see more swing states than any time since with 15 total swing states, and most of these happened to be Republican. There were few geographic trends of where these states were located. In 1980, virtually every swing state was either in the Southeast or the Northeast. Through the Republican dominance of the 1980s, there were only 2 and then 4 swing states in 1984 and 1988, respectively. In 1992 and 1996, there were more swing states (8 and 9), and these were located near the Western coast or along the Eastern coast. In 2000, 2004, and 2008, the swing states were different virtually every year with no geographic significance. 2012 marked a year of only three swing states, 2016 had more but virtually every swing state was along the coast, and 2020 was similar to 2016. Throughout the years, there have been very few consistent swing states. North Carolina appears to be the most consistent swing state throughout the years, though it was only statistically a swing state in five of the twelve elections. Other classic swing states such as Arizona and Michigan are only “swing,” according to our definition, two or three times throughout this era.
:::

::: {.card title="Limitations" .flow} 
Our work does have a few limitations and challenges. One is that those unfamiliar with United States geography may not understand which states are which on our graph. However, we felt that labeling the states was the only solution to this problem, and doing so would highly clutter our map. Thus, our map is directed towards those who know American geography. We additionally had to exclude the District of Columbia in our gradient map because it was so Democrat-leaning that it made every other Democratic state look almost white on the map (our gradient relies on comparing the most extreme states to more moderate states for coloring; even heavy-leaning democratic states looked only moderately blue). However, because DC is so geographically small, it would have been hard to see in the first place, and excluding it does not change the look of our graph. Going forward, we plan to use this dashboard as an informational tool to better educate people on trends throughout the years, especially in preparation for this upcoming election. It is important that people understand where current voting trends stand in the context of a historical lens. 
:::

::: {.card title="Conclusion" .flow}
We originally wanted to create a tool to see how voting patterns by state have changed, and we wanted to see how swing states have changed in presidential elections from 1976 to 2020. As a result of our work and methodologies, we can see these patterns on a by-state basis. Through our interactive Quarto dashboard, we aim to provide users with a comprehensive tool to investigate changes in voting patterns and the emergence of swing states since 1976. The dashboard is an effective resource for understanding historical voting trends and preparing for future elections. Moving forward, we hope the dashboard will educate individuals on the evolution of state-level voting behaviors, something important to consider in election contexts. 
:::

# About

::: {.card}
This project was developed by Team Ella in Spring 2024 for [STA/ISS 313: Advanced Data Visualization](https://vizdata.org/) at Duke University. The team is comprised of the following team members.

-   Ryan Silver: My name is [Ryan Silver](https://github.com/ryan-silver) and I am a sophomore from St. Louis, Missouri majoring in Economics and minoring in Statistical Science. I love playing pickle ball and racquetball in my free time.
-   Alexa Fahrer: My name is [Alexa Fahrer](https://github.com/alexafahrer) and I am a sophomore from Phoenix, Arizona double majoring in Public Policy and Statistics with a minor in Education. In my free time, I enjoy watching movies, cheering on the 49ers, and playing pickle ball.
-   Ella Hartman: My name is [Ella Hartman](https://github.com/ellahartman) and I am a senior from Birmingham, Alabama studying Computer Science and Economics.
-   Noah Costa: My name is [Noah Costa](https://github.com/Noah-Costa14) and I am a senior from Long Island, New York studying Computer Science. I enjoy golfing and hanging out with my friends on the BC Plaza in my free time.
:::